# Java NIO vs. IO

当我们同时学习Java NIO和标准IO的时候，我们可能会有个问题：

> 何时使用NIO？何时使用IO？

本文将会简单的来说明一下Java中NIO和标准IO的区别，以及在使用它们进行代码设计时需要注意哪些事项。

## 主要的区别

下面表格是NIO和IO的对比汇总，后边将对其中的每个点进行详细讨论：

| IO | NIO |
| :--- | :--- |
| 面向流\(stream\)编程 | 面向缓存\(buffer\)编程 |
| 阻塞IO | 非阻塞IO |
| 无 | 支持选择器\(Selectors\) |

## 面向流 VS 面向缓存

首先，Java NIO和标准IO之间最大的一个区别就是标准IO是面向流的，而NIO是面向缓存的。

标准IO是面向流的，意味着你可以从流中读一个或多个字节的数据。数据读取出来之后用来做什么事情，取决于程序实现的逻辑。在从流中读取数据时，不能后退去读取已读过的数据，也不能随机往前跳跃去读取数据。如果想实现流的随机读取，那么就得先把流中的所有数据都先缓存下来。

NIO是面向缓存（buffer）的，与标准IO略有不同。NIO中数据会被读取到缓存中，晚些才会处理。如果需要，可以在buffer中向前、向后移动下标，读取自己想要的数据。大大的提升了NIO操作的伸缩性。然而，为了能够完整的处理buffer中的数据，需要检查一下该buffer中的数据是否是完整的。需要注意，当在往buffer中写入更多的数据时，不要覆盖掉buffer中还未读取出来的数据。

## 阻塞 VS 非阻塞

Java标准IO中很多流都是阻塞的。当对流进行读写操作时，方法将会进入阻塞，只有完成读写的时候方法才会返回。阻塞期间该线程不能做任何其它操作。

Java NIO在非阻塞模式下，允许在线程从一个channel中读数据时，即使读取不到数据，也会立马返回。而不是一直阻塞直到有新的数据到来。期间线程可以去做其它任何想做的事情。

非阻塞写也是如此，线程将会请求把数据写入到channel中去，但是不会等待数据完全被写入后才返回。方法会立马返回，期间该线程可以去做任何想做的事情。

当一个线程一个线程非阻塞调用后，可以立马处理其它channel的数据。因此，单线程可以同时管理多个channel的读和写。

## Selector（选择器）

Java NIO的Selector允许单个线程同时监控多个channel的读写等事件。可以向Selector上注册多个channel，然后用一个线程去执行select方法，监听Channel的事件。在管理多个channel时，使用一个单线程执行Selector，一切都变得简单了。

## NIO和标准IO对应用设计的影响

> 非阻塞模式下，数据下去之后，怎么保证数据可以写入成功呢。



